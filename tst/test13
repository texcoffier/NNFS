#!/bin/sh

. ./init_test

export LC_ALL=POSIX

echo "*** Long file names (to test the report function)"

runA -f $H/A
runB -a $H/B


for I in	A/B/C/D/E/F/G/H/I/J/K/L/M/N/O \
		AA/BB/CC/DD/EE/FF/GG/HH/II/JJ \
		AAA/BBB/CCC/DDD/EEE/FFF/GGG/HHH \
		AAAA/BBBB/CCCC/DDDD/EEEE/FFFF \
		AAAAA/BBBBB/CCCCC/DDDDD/EEEEE \
		AAAAAA/BBBBBB/CCCCCC/DDDDDD/EEEEEE \
		AAAAAAA/BBBBBBB/CCCCCCC/DDDDDDD \
		AAAAAAAAAA/BBBBBBBBBB/CCCCCCCCCC \
		AAAAAAAAAAAAA/BBBBBBBBBBBBB/CCCCCCCCCCCCC \
		AAAAAAAAAAAAAAAA/BBBBBBBBBBBBBBBB \
		AAAAAAAAAAAAAAAAAAA/BBBBBBBBBBBBBBBBBBB \
		12345678901234A678901234 \
		12345678901234B6789012345 \
		12345678901234C67890123456 \
		x/12345678901234A6789012 \
		x/12345678901234B67890123 \
		x/12345678901234C678901234
do
	I="$H/A/$I"
	Y=`dirname $I`
	if [ "" != "$Y" ]
		then
		mkdir -p $Y
		fi
	echo $I >$I
done

LINES=500
COLUMNS=56
export LINES COLUMNS
runA


cat >TMP/xxx <<EOT
  ... (W)rite (X)change: RW   (C)onflict (D)elete
W ...345678901234C678901234
W ...5678901234C67890123456
W 12345678901234A678901234
W 12345678901234B6789012345
W A...BBBBBBBBBB/CCCCCCCCCC
W A/B/C/D/E/F...J/K/L/M/N/O
W AA/BB/CC/DD...GG/HH/II/JJ
W AAA...BBBBBBBBBBBBBBBBBBB
W AAA/BBB/CCC...FFF/GGG/HHH
W AAAA/BBB...DDDD/EEEE/FFFF
W AAAAA/BBBBB...DDDDD/EEEEE
W AAAAAA...BBBBBBBBBBBBBBBB
W AAAAAA/BB...DDDDDD/EEEEEE
W AAAAAAA...CCCCCCC/DDDDDDD
W AAAAAAAAA...CCCCCCCCCCCCC
W x/12345678901234A6789012
W x/12345678901234B67890123
EOT


fgrep -v -e "NNFS:" <TMP/3. | fgrep -v -e "To " | sed 's/ *$//g' | grep -v -e "^$" | sort >TMP/yyy

if cmp -s TMP/xxx TMP/yyy
	then
	Exit 0
else
	diff TMP/xxx TMP/yyy
	Exit 1
fi


[ -d $H/A/.nnfs/history ] && Exit 254
[ -d $H/B/.nnfs/history ] && Exit 254
Exit 0
